using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using NinMods.Logging;

namespace NinMods.Bot
{
    public class BotCommand_ExploitMovementToStaticPoint : IBotCommand
    {
        bool hasFailedCatastrophically = false;
        bool hasReachedDestination = false;

        Stack<Vector2i> path = null;

        public BotCommand_ExploitMovementToStaticPoint(Vector2i destination)
        {
            path = Pathfinder.GetPathTo(destination.x, destination.y);
        }

        public bool IsComplete()
        {
            return ((hasReachedDestination) && (hasFailedCatastrophically == false));
        }

        public bool Perform()
        {
            if (path == null)
                hasFailedCatastrophically = true;
            if (hasFailedCatastrophically)
                return false;

            if (path.Count == 0)
            {
                hasReachedDestination = true;
                return true;
            }
            Vector2i botLocation, tileDirection;
            bool isMovementGood = GameExploits.Movement(path, out botLocation, out tileDirection);
            if (isMovementGood == false)
            {
                Logger.Log.WriteError($"Could not move bot at {botLocation} in direction {tileDirection}");
                hasFailedCatastrophically = true;
                return false;
            }
            return true;
        }
    }
}
